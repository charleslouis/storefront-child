function isMobile(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/BlackBerry/)}function scrollBanner(){scrollPos=jQuery(this).scrollTop(),jQuery("#bannerText").css({"margin-top":-(scrollPos/3)+"px",opacity:1-scrollPos/300}),jQuery("#homeBanner").css({"background-position":"center "+-scrollPos/30+"px"})}function setBaseUrl(){var e=jQuery("#products-list--occasion"),t=e.data("postid"),i=e.data("fieldname"),r=e.data("url");return r+="/templates/popup-occasion.php?id="+t+"&fieldname="+i+"&subfield="}function initModalWrapper(){jQuery("#product-detail-full").hide(),jQuery("#close").live("click",function(e){e.preventDefault(),jQuery("#product-detail-full").hide()}),jQuery(document).keydown(function(e){27==e.keyCode&&jQuery("#product-detail-full").hide(),39==e.keyCode&&jQuery("#next-bike").trigger("click"),37==e.keyCode&&jQuery("#previous-bike").trigger("click")}),loadModalFromPrevNext("#previous-bike"),loadModalFromPrevNext("#next-bike")}function setPreviousBike(e,t){var i;return e=parseInt(e),i=0===e?t-1:e-1}function setNextBike(e,t){var i;return e=parseInt(e),i=0===e?1:e===t-1?0:e+1}function loadModal(e){var t=setBaseUrl();t+=e;for(var i=(jQuery("#number-of-bikes").data("number-of-bikes"),jQuery("#number-of-bikes").data("number-of-displayed-bikes"),jQuery("#number-of-bikes").data("displayed-bikes")),r=[],n=i.length-1;n>=0;n--)parseInt(i[n])>=0&&r.push(parseInt(i[n]));jQuery.ajax({url:t,success:function(e){jQuery("#product-detail-full-content").empty().load(t),jQuery("#product-detail-full").fadeIn(300)}})}function loadModalFromThumbnail(){jQuery(".product-occasion").click(function(){setCurrentBikeClass(this);var e=jQuery(this).data("subfield");loadModal(e),setUpPrevNextIndexes("#products-list--occasion",".product-occasion",e)})}function loadModalFromPrevNext(e){jQuery(e).live("click",function(e){e.preventDefault();var t=jQuery(this).attr("data-bikeindex");findCurrentBikeElemFromButtons("#products-list--occasion",".product-occasion",t),loadModal(t),setUpPrevNextIndexes("#products-list--occasion",".product-occasion",t)})}function createChildrenMap(e,t){var i=jQuery(e).find(t),r=[];setTimeout(function(){var e=0;i.each(function(){jQuery(this).is(":visible")&&(r.push(jQuery(this).data("subfield")),jQuery(this).attr("data-subfields-array-key",e),e++)}),jQuery("#number-of-bikes").attr("data-number-of-displayed-bikes",r.length),jQuery("#number-of-bikes").attr("data-displayed-bikes",r)},500)}function getCurrentBikeInModal(e){var t=jQuery(".product-occasion").filter(function(){return jQuery(this).attr("data-subfield")==e});return t}function setUpPrevNextIndexes(e,t,i){var r=(getCurrentBikeInModal(i),jQuery(t).prevAll("article:visible").first()),n=r.attr("data-subfield"),a=jQuery(t).prevAll("article:visible").last(),o=a.attr("data-subfield"),s=jQuery("#products-list--occasion").find(".current-bike").prevAll("article:visible").first(),u=jQuery(s).attr("data-subfield")||o,l=jQuery("#products-list--occasion").find(".current-bike").nextAll("article:visible").first(),c=jQuery(l).attr("data-subfield")||n;jQuery("#previous-bike").attr("data-bikeindex",u),jQuery("#next-bike").attr("data-bikeindex",c)}function setCurrentBikeClass(e){jQuery(e).addClass("current-bike"),jQuery(e).siblings().removeClass("current-bike")}function findCurrentBikeElemFromButtons(e,t,i){var r=jQuery(e).find(t);r.each(function(){jQuery(this).attr("data-subfield")===i&&setCurrentBikeClass(this)})}function filterBikes(){jQuery("#size-filter").find('li[data-size-filter="Toutes+les+tailles"]').addClass("active");var e;getCurrentBikeFilterInUrl("bike-filter")&&(e=getCurrentBikeFilterInUrl("bike-filter"),filterHideShowBikes(e,createChildrenMap("#products-list--occasion","article")),setCurrentButtonBikeFilter("#size-filter","li","active","size-filter",e)),jQuery("#size-filter li").click(function(){e=jQuery(this).data("size-filter"),jQuery(this).addClass("active").siblings().removeClass("active"),filterHideShowBikes(e,createChildrenMap("#products-list--occasion","article")),window.history.replaceState({},"title",updateQueryString("bike-filter",e))})}function filterHideShowBikes(e){var t=jQuery("#products-list--occasion .product-occasion");jQuery(t).fadeOut("fast"),"Toutes+les+tailles"==e?jQuery("#products-list--occasion").find("article").each(function(e){jQuery(this).delay(200).slideDown("fast")}):jQuery("#products-list--occasion").find('article[data-size="'+e+'"]').each(function(e){jQuery(this).delay(200).slideDown("fast")})}function getCurrentBikeFilterInUrl(e){var t=location.search.split(e+"=")[1];return t}function setCurrentButtonBikeFilter(e,t,i,r,n){jQuery(e).find("li[data-"+r+'="'+n+'"]').each(function(e){jQuery(this).addClass(i).siblings().removeClass(i)})}function updateQueryString(e,t,i){i||(i=window.location.href);var r,n=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(n.test(i))return"undefined"!=typeof t&&null!==t?i.replace(n,"$1"+e+"="+t+"$2$3"):(r=i.split("#"),i=r[0].replace(n,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof r[1]&&null!==r[1]&&(i+="#"+r[1]),i);if("undefined"!=typeof t&&null!==t){var a=-1!==i.indexOf("?")?"&":"?";return r=i.split("#"),i=r[0]+a+e+"="+t,"undefined"!=typeof r[1]&&null!==r[1]&&(i+="#"+r[1]),i}return i}function sortBikesByPrice(e,t,i){var r=jQuery(e),n=r.children(t);n.sort(function(e,t){var r=e.getAttribute(i),n=t.getAttribute(i);return r>n?1:n>r?-1:0}),n.detach().appendTo(r)}!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var t=-1,i=-1,r=function(e){return parseFloat(e)||0},n=function(t){var i=1,n=e(t),a=null,o=[];return n.each(function(){var t=e(this),n=t.offset().top-r(t.css("margin-top")),s=o.length>0?o[o.length-1]:null;null===s?o.push(t):Math.floor(Math.abs(a-n))<=i?o[o.length-1]=s.add(t):o.push(t),a=n}),o},a=function(t){var i={byRow:!0,property:"height",target:null,remove:!1};return"object"==typeof t?e.extend(i,t):("boolean"==typeof t?i.byRow=t:"remove"===t&&(i.remove=!0),i)},o=e.fn.matchHeight=function(t){var i=a(t);if(i.remove){var r=this;return this.css(i.property,""),e.each(o._groups,function(e,t){t.elements=t.elements.not(r)}),this}return this.length<=1&&!i.target?this:(o._groups.push({elements:this,options:i}),o._apply(this,i),this)};o.version="0.7.0",o._groups=[],o._throttle=80,o._maintainScroll=!1,o._beforeUpdate=null,o._afterUpdate=null,o._rows=n,o._parse=r,o._parseOptions=a,o._apply=function(t,i){var s=a(i),u=e(t),l=[u],c=e(window).scrollTop(),d=e("html").outerHeight(!0),f=u.parents().filter(":hidden");return f.each(function(){var t=e(this);t.data("style-cache",t.attr("style"))}),f.css("display","block"),s.byRow&&!s.target&&(u.each(function(){var t=e(this),i=t.css("display");"inline-block"!==i&&"flex"!==i&&"inline-flex"!==i&&(i="block"),t.data("style-cache",t.attr("style")),t.css({display:i,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px",overflow:"hidden"})}),l=n(u),u.each(function(){var t=e(this);t.attr("style",t.data("style-cache")||"")})),e.each(l,function(t,i){var n=e(i),a=0;if(s.target)a=s.target.outerHeight(!1);else{if(s.byRow&&n.length<=1)return void n.css(s.property,"");n.each(function(){var t=e(this),i=t.attr("style"),r=t.css("display");"inline-block"!==r&&"flex"!==r&&"inline-flex"!==r&&(r="block");var n={display:r};n[s.property]="",t.css(n),t.outerHeight(!1)>a&&(a=t.outerHeight(!1)),i?t.attr("style",i):t.css("display","")})}n.each(function(){var t=e(this),i=0;s.target&&t.is(s.target)||("border-box"!==t.css("box-sizing")&&(i+=r(t.css("border-top-width"))+r(t.css("border-bottom-width")),i+=r(t.css("padding-top"))+r(t.css("padding-bottom"))),t.css(s.property,a-i+"px"))})}),f.each(function(){var t=e(this);t.attr("style",t.data("style-cache")||null)}),o._maintainScroll&&e(window).scrollTop(c/d*e("html").outerHeight(!0)),this},o._applyDataApi=function(){var t={};e("[data-match-height], [data-mh]").each(function(){var i=e(this),r=i.attr("data-mh")||i.attr("data-match-height");r in t?t[r]=t[r].add(i):t[r]=i}),e.each(t,function(){this.matchHeight(!0)})};var s=function(t){o._beforeUpdate&&o._beforeUpdate(t,o._groups),e.each(o._groups,function(){o._apply(this.elements,this.options)}),o._afterUpdate&&o._afterUpdate(t,o._groups)};o._update=function(r,n){if(n&&"resize"===n.type){var a=e(window).width();if(a===t)return;t=a}r?-1===i&&(i=setTimeout(function(){s(n),i=-1},o._throttle)):s(n)},e(o._applyDataApi),e(window).bind("load",function(e){o._update(!1,e)}),e(window).bind("resize orientationchange",function(e){o._update(!0,e)})}),function(e){e.fn.fitText=function(t,i){var r=t||1,n=e.extend({minFontSize:Number.NEGATIVE_INFINITY,maxFontSize:Number.POSITIVE_INFINITY},i);return this.each(function(){var t=e(this),i=function(){t.css("font-size",Math.max(Math.min(t.width()/(10*r),parseFloat(n.maxFontSize)),parseFloat(n.minFontSize)))};i(),e(window).on("resize.fittext orientationchange.fittext",i)})}}(jQuery),jQuery(document).ready(function(e){isMobile()||jQuery(window).scroll(function(){scrollBanner()}),jQuery("#homeBanner h2").fitText(1.7,{minFontSize:"24px",maxFontSize:"64px"}),jQuery(".product-thumnail").matchHeight(),jQuery(".product").matchHeight(),filterBikes(),initModalWrapper(),loadModalFromThumbnail(),sortBikesByPrice("#products-list--occasion","article","data-price"),createChildrenMap("#products-list--occasion","article")});